(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{358:function(e,t,n){var content=n(371);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(47).default)("5ce6b50c",content,!0,{sourceMap:!1})},359:function(e,t,n){var content=n(373);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(47).default)("aec82cb6",content,!0,{sourceMap:!1})},370:function(e,t,n){"use strict";n(358)},371:function(e,t,n){var r=n(46)(!1);r.push([e.i,".row-wrapper[data-v-5fece03e]{display:flex;flex-direction:row;margin-bottom:1rem}.row-wrapper>*[data-v-5fece03e]{flex:1}.marginTop[data-v-5fece03e]{margin-top:1rem}.limitInputWidth[data-v-5fece03e]{max-width:80%}.b-tags-wrapper[data-v-5fece03e]{display:flex;flex-direction:row;flex-wrap:wrap;margin-bottom:.5rem;align-items:baseline}.b-tags-wrapper>*[data-v-5fece03e]{margin-right:.5rem}.newLines[data-v-5fece03e]{display:flex;flex-direction:column;align-items:flex-start}.newLines[data-v-5fece03e],.newLines>*[data-v-5fece03e]{margin-bottom:.5rem}",""]),e.exports=r},372:function(e,t,n){"use strict";n(359)},373:function(e,t,n){var r=n(46)(!1);r.push([e.i,".margin-b-tag[data-v-48297a42]{padding-bottom:10px}.group-field>*[data-v-48297a42],.my-nav-bar[data-v-48297a42]{margin-bottom:40px}.my-nav-bar[data-v-48297a42]{display:flex;justify-content:space-between}.nav-bar-item[data-v-48297a42]{display:flex;padding-right:40px}.is-active[data-v-48297a42]{font-weight:700;text-decoration:underline;color:purple}.pb-10[data-v-48297a42]{padding-bottom:10px}",""]),e.exports=r},396:function(e,t,n){"use strict";n.r(t);n(40),n(18),n(51),n(52);var r=n(2),o=n(22),c=(n(14),n(39),n(24),n(17),n(19),n(9),n(62),{name:"GroupCard",props:["group","theIndex","disableEdit"],data:function(){return{isEditing:!1,additionalRaUsernames:[],additionalLdapStrs:[]}},computed:{confirmKeys:function(){return["Enter"]},onPasteSeparators:function(){return[]}},methods:{enterEditMode:function(){this.isEditing=!0},saveChanges:function(){var e=JSON.parse(JSON.stringify(this.group));e.username=this.group.username.trim(),e.researchAssistants.concat(this.additionalRaUsernames.map((function(e){return e.trim()}))),e.ldapGroups.concat(this.additionalLdapStrs.map((function(e){return e.trim()}))),this.additionalRaUsernames=[],this.additionalLdapStrs=[],this.$emit("saveChangesToGroup",this.theIndex,e),this.isEditing=!1},handleRemoveRaUsername:function(e){this.group.researchAssistants.splice(e,1)},handleRemoveLdapStr:function(e){this.group.ldapGroups.splice(e,1)}}}),l=(n(370),n(29)),d=Object(l.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("header",{staticClass:"card-header"},[n("p",{staticClass:"card-header-title"},[e._v(e._s(e.group.name))]),e._v(" "),e._m(0)]),e._v(" "),n("div",{staticClass:"card-content"},[n("div",{staticClass:"content"},[n("div",{staticClass:"row-wrapper"},[n("div",[n("label",{staticClass:"label"},[e._v("Display Name")]),e._v(" "),e.isEditing?n("b-input",{staticClass:"limitInputWidth",model:{value:e.group.name,callback:function(t){e.$set(e.group,"name",t)},expression:"group.name"}}):n("div",[e._v(e._s(e.group.name))])],1),e._v(" "),n("div",[n("label",{staticClass:"label"},[e._v("Group Leader username")]),e._v(" "),n("div",[e._v(e._s(e.group.username))])]),e._v(" "),n("div",[n("label",{staticClass:"label"},[e._v("Research Assistant usernames")]),e._v(" "),n("b-taglist",{staticClass:"b-tags-wrapper"},[e.isEditing?n("b-taginput",{attrs:{ellipsis:"",type:"is-success",icon:"label",placeholder:"Type a tag then hit enter to add it","aria-close-label":"Delete this tag"},model:{value:e.group.researchAssistants,callback:function(t){e.$set(e.group,"researchAssistants",t)},expression:"group.researchAssistants"}}):n("div",e._l(e.group.researchAssistants,(function(t,r){return n("b-tag",{key:r,attrs:{type:"is-success",attached:"",closable:e.isEditing,"aria-close-label":"Close tag"},on:{close:function(t){return e.handleRemoveRaUsername(r)}}},[e._v("\n                "+e._s(t)+"\n              ")])})),1)],1)],1)]),e._v(" "),n("div",{staticClass:"marginTop"},[n("label",{staticClass:"label"},[e._v("LDAP Groups")]),e._v(" "),n("b-taglist",{staticClass:"b-tags-wrapper"},[e.isEditing?n("b-taginput",{staticClass:"full-width",attrs:{ellipsis:"","confirm-keys":e.confirmKeys,"on-paste-separators":e.onPasteSeparators,type:"is-danger",icon:"label",placeholder:"Type a tag then hit enter to add it","aria-close-label":"Delete this tag"},model:{value:e.group.ldapGroups,callback:function(t){e.$set(e.group,"ldapGroups",t)},expression:"group.ldapGroups"}}):n("div",e._l(e.group.ldapGroups,(function(t,r){return n("b-tag",{key:r,staticClass:"full-width",attrs:{type:"is-danger",attached:"",closable:e.isEditing,"aria-close-label":"Close tag"},on:{close:function(t){return e.handleRemoveLdapStr(r)}}},[e._v("\n              "+e._s(t)+"\n            ")])})),1)],1)],1)])]),e._v(" "),n("footer",{staticClass:"card-footer"},[e.isEditing?n("a",{staticClass:"card-footer-item",on:{click:e.saveChanges}},[e._v("Save")]):n("a",{staticClass:"card-footer-item",on:{click:e.enterEditMode}},[e._v("Edit")])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"card-header-icon",attrs:{"aria-label":"more options"}},[t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])])}],!1,null,"5fece03e",null).exports;function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f={confirmText:"Approve",cancelText:"Cancel",type:"is-success",hasIcon:!0,onCancel:function(){window.location.reload(!0)}},h={middleware:"auth",components:{GroupCard:d},asyncData:function(e){return e.$axios.get("/api/admin").then((function(e){var t=[e.data.species,e.data.genotypes,e.data.vectorSelections,e.data.tdnaSelections,e.data.agroStrains,e.data.admins],n=["Species","Genotypes","Vector selections","T-DNA selections","Agro Strains","Admins"],r=["Specie","Genotype","VectorSelection","TdnaSelection","AgroStrain","Admin"].map((function(e,r){return{mongoName:e,name:n[r],active:t[r]&&t[r].length&&t[r].filter((function(e){return!e.archived})),archived:t[r]&&t[r].length&&t[r].filter((function(e){return e.archived})),toAdd:""}}));return{ldapGroups:e.data.groups,editItems:r,activeTab:"Specie"}})).catch((function(e){return console.error(e),{namedConstructs:null}}))},methods:{displaySuccessfulChanges:function(){this.$buefy.notification.open({message:"Changes successfully saved",type:"is-success",duration:5e3})},displayUnexpectedError:function(){this.$buefy.notification.open({message:"Unexpected error. Please try again or contact system admin.",type:"is-danger",duration:5e3})},databasePost:function(e,t,n,r){var o=this;return this.$axios.post("/api/admin/active",{mongoName:e,_id:t,fieldToChange:n,newFieldValue:r}).then((function(e){return 200===e.status?(o.displaySuccessfulChanges(),!0):(o.displayUnexpectedError(),!1)})).catch((function(e){return o.displayUnexpectedError(),!1}))},updateLdapGroup:function(e,t){var n,o=this;this.$buefy.dialog.confirm(m(m({title:"Confirm update",message:'Update LDAP group with changes made? If you have made no changes, please press "Cancel"'},f),{},{onConfirm:(n=Object(r.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",o.$axios.post("/api/admin/group",{group:t}).then((function(n){return 200===n.status?(o.ldapGroups[e]=t,void o.displaySuccessfulChanges()):void o.displayUnexpectedError()})).catch((function(e){return o.displayUnexpectedError(),!1})));case 1:case"end":return n.stop()}}),n)}))),function(){return n.apply(this,arguments)})}))},promptToArchive:function(e,t,n){var o,c=this;this.$buefy.dialog.confirm(m(m({title:"Approve archive",message:"Are you sure you want to archive this field?"},f),{},{onConfirm:(o=Object(r.a)(regeneratorRuntime.mark((function r(){var o,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.databasePost(c.editItems[e].mongoName,n,"archived",!0);case 2:r.sent&&(o=c.editItems.slice(),l=o[e].active[t],c.editItems[e].active.splice(t,1),c.editItems[e].archived.push(l));case 4:case"end":return r.stop()}}),r)}))),function(){return o.apply(this,arguments)})}))},promptToReactivate:function(e,t,n){var o,c=this;this.$buefy.dialog.confirm(m(m({title:"Approve activate",message:"Are you sure you want to re-activate this field?"},f),{},{onConfirm:(o=Object(r.a)(regeneratorRuntime.mark((function r(){var o,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:c.databasePost(c.editItems[e].mongoName,n,"archived",!1)&&(o=c.editItems.slice(),l=o[e].archived[t],c.editItems[e].archived.splice(t,1),c.editItems[e].active.push(l));case 2:case"end":return r.stop()}}),r)}))),function(){return o.apply(this,arguments)})}))},getIsClosable:function(e,t,n){return("deeks"!==t.name||"Admin"!==n)&&e.length>1},setActiveTab:function(e){this.activeTab=e},submitAdditional:function(e){var t,n=this,o=this.editItems[e],c=o.mongoName,l=o.toAdd;this.$buefy.dialog.confirm(m(m({title:"Approve addition",message:"Are you sure you want to add this entry?"},f),{},{onConfirm:(t=Object(r.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=l.trim(),t.abrupt("return",n.$axios.post("/api/admin/additional",{mongoName:c,newFieldValue:r}).then((function(t){return 200===t.status?(n.displaySuccessfulChanges(),n.editItems[e].active.push({archived:!1,name:r}),!0):(n.displayUnexpectedError(),!1)})).catch((function(e){return n.displayUnexpectedError(),!1})).finally((function(){n.editItems[e].toAdd=""})));case 2:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}))},getDisabledAddNew:function(e){var t=this.editItems[e].toAdd;if(""===t)return!0;var n=t.trim(),r=[];return this.editItems.forEach((function(e){e.active.forEach((function(e){r.push(e.name)})),e.archived.forEach((function(e){r.push(e.name)}))})),!!r.includes(n)}}},_=h,y=(n(372),Object(l.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",{staticClass:"title is-2"},[e._v("Edit database (Admin)")]),e._v(" "),this.$auth.$state.user.isAdmin?e._e():n("div",{staticClass:"title is-4"},[n("p",[e._v("You are not permitted to view this page.")])]),e._v(" "),n("div",{staticClass:"crudWrapper"},[n("div",{staticClass:"container"},[n("h3",{staticClass:"title is-5"},[e._v("\n        Please click a link to see database editing options\n      ")]),e._v(" "),n("hr"),e._v(" "),n("div",{staticClass:"my-nav-bar"},[e._l(e.editItems,(function(t,r){return n("a",{key:"j"+r,class:e.editItems[r].mongoName===e.activeTab?"nav-bar-item is-active":"nav-bar-item",on:{click:function(t){return e.setActiveTab(e.editItems[r].mongoName)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),e._v(" "),n("a",{class:"ldapGroups"===e.activeTab?"nav-bar-item is-active":"nav-bar-item",on:{click:function(t){return e.setActiveTab("ldapGroups")}}},[e._v("\n          LDAP Groups\n        ")])],2),e._v(" "),n("div",[e._l(e.editItems,(function(t,r){return n("div",{key:"jj"+r,ref:"inputs",refInFor:!0,attrs:{label:t.name}},[e.activeTab===t.mongoName?n("div",{staticClass:"normal-field"},[n("label",{staticClass:"label"},[e._v("Active")]),e._v(" "),t.active&&t.active.length?n("div",e._l(t.active,(function(o,c){return n("div",{key:"jjj"+c,staticClass:"margin-b-tag"},[n("b-tag",{attrs:{size:"is-medium",closable:e.getIsClosable(t.active,o,t.mongoName),"aria-close-label":"Close tag"},on:{close:function(t){return e.promptToArchive(r,c,o._id)}}},[e._v("\n                  "+e._s(o.name)+"\n                ")])],1)})),0):n("div",[n("p",{staticClass:"pb-10"},[e._v("No active items.")])]),e._v(" "),n("div",[n("label",[e._v("Add new:")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.toAdd,expression:"obj.toAdd"}],domProps:{value:t.toAdd},on:{input:function(n){n.target.composing||e.$set(t,"toAdd",n.target.value)}}}),e._v(" "),n("b-button",{attrs:{disabled:e.getDisabledAddNew(r)},on:{click:function(t){return e.submitAdditional(r)}}},[e._v("Submit")])],1),e._v(" "),n("br"),e._v(" "),n("label",{staticClass:"label"},[e._v("Archived")]),e._v(" "),t.archived&&t.archived.length?n("div",e._l(t.archived,(function(t,o){return n("div",{key:"jjjj"+o,staticClass:"margin-b-tag"},[n("b-tag",{attrs:{size:"is-medium",closable:"",attached:"","close-icon":"upload","aria-close-label":"Close tag"},on:{close:function(n){return e.promptToReactivate(r,o,t._id)}}},[e._v("\n                  "+e._s(t.name)+"\n                ")])],1)})),0):n("div",[n("p",[e._v("No archived items.")])])]):e._e()])})),e._v(" "),"ldapGroups"===e.activeTab?n("div",{staticClass:"group-field",attrs:{label:"LDAP groups"}},[e._m(0),e._v(" "),e._l(e.ldapGroups,(function(t,r){return n("GroupCard",{key:"jjjjjjjjj"+r,attrs:{theIndex:r,group:t},on:{saveChangesToGroup:e.updateLdapGroup}})}))],2):e._e()],2)])])])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h4",{staticClass:"title is-6"},[n("i",[e._v("Please edit and save groups one at a time.")])])}],!1,null,"48297a42",null));t.default=y.exports}}]);